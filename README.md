# Benthic occurrences, habitat maps, and species traits

The aim of this project is to link occurrences of benthic invertebrates from the [EMODnet benthic numerical abundance product](https://mda.vliz.be/directlink.php?fid=VLIZ_00000727_60196601e2e81.EMODnet) to two complementary seabed habitat products: the [EMODnet broadscale habitat map](http://gis.ices.dk/geonetwork/srv/eng/catalog.search#/metadata/01bf1f24-fdcd-4ee7-af8b-e62cf72fe2f9), and Wilson et al.'s (2018) [synthetic map of the north-west European Shelf sedimentary environment](https://doi.org/10.5194/essd-10-109-2018). We also process and incorporate qualitative information on the habitat and sediment preferences of species from the Biological Traits Information Catalogue [BIOTIC](http://www.marlin.ac.uk/biotic/ database).


## Directory structure

```
{{EMODnet_occs_habs}}/
├── analysis
├── data/
│   ├── derived_data/
│   └── raw_data/
├── docs/
├── product/
└── scripts/
```

* **analysis** - Markdown notebooks
* **data** - Raw and derived data
* **docs** - Rendered reports
* **product** - Output product files
* **scripts** - Reusable code

## Data

Raw data on individual traits from [BIOTIC](http://www.marlin.ac.uk/biotic/) have been included in the data/raw_data folder. The other key raw datasets are all available online, and the scripts provded here show how they are dowloaded and imported. Processed and derived datasets that are generated by the scripts are all saved to the 'derived data' folder. These are fully described in the markdown documents in which they are generated.

## Analysis

There are three workbooks included in this folder:
1. 'species and traits.Rmd' describes the processing of BIOTIC habitat traits data to generate a dataset of species with documented substrate preferences and habitat affinities.
2. 'benthic data habitat matching.Rmd' describes the process of downloading, importing, and processing the benthic numerical abudance product, the broadscale seabed habitat map, and the sediment properties map, and linking these all together to generate the three key datasets that the generation of the data products requires:
 + benthic_abundance_sampling_events_seabed_habs.csv, which contains information on each distinct sampling event, including its estimated seabed habitat characteristics;
 + benthic_abundances_long.csv which is a minimal and memory-efficient version of the numerical abundance product;
 + benthic_taxa.csv which contains taxonomic information on all the taxa included in the numerical abundance product.
3. 'benthic species habitat dashboards.Rmd' describes the use of these processed datasets to produce two kinds of product:
 + species-level summaries, averaging the complete set of seabed habitat / sediment properties over all known occurrences of the species (weighted by abundance). A complementary summary over all sample events is also produced;
 + individual species plots, showing how a species' occurrences are distributed across both continuous (median sediment particle diameter, and percentage of mud, sand, and gravel) and categorical (Seabed Habitat Map Substrate, EUNIS classification, and MSFD classification) habitat variables. The distribution of these variables across all sampling events is also shown for comparison.

These workbooks are all rendered into html reports in the docs folder.

## Scripts
The three functions used to generate the products are included as separate scripts which are sourced in 'benthic species habitat dashboards.Rmd':
1. get_species_habitats.R gets an abundance-weighted species-level summary, averaging the complete set of seabed habitat / sediment properties over all known occurrences of the species (weighted by abundance);
2. get_event_habitats.R does the same as (1) but for all sampling events;
3. plot_species_habitats.R produces the composite plot for a given species, and either prints it, saves it to file (as an A4 pdf), or both.

## Products

1. benthic_specicies_habitat_summaries.csv for each of 3287 taxa a single row with some basic summary data, all habitat information from BIOTIC, and summaries of all the derived habitat variables - means (weighted by abundance) for continuous variables, frequencies (weighted by abundance) for categorical variables. In all there are 148 variables per species.
2. benthic_sampling_event_habitat_summaries.csv contains similar information but averaged over all individual sampling events (1 row x 114 variables).
3. The subfolder species_hab_plots contains a composite plot illustrating habitat affinities for selected species. Code for generating these plots for all species occurring in more than 20 sampling events is provided in the benthic species habitat dashboards document. Each plot has the filename strucure Aphia####_habitat_plot.pdf where #### is the Aphia ID of that taxon. Each plot is saved as an A4 pdf. The title of the plot gives the taxon scientific name and Aphia ID, the subtitle presents the number of sampling events in which the species occurs which have been matched to the different habitat variables. Habitat preference information from BIOTIC is also presented, if available.

...

## Citation

Please cite this product as:
*{{citation}}*